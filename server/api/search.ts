import Exa from 'exa-js';

export default defineEventHandler(async (event) => {
    const query = getQuery(event)

    const searchQuery = query.query
    const showSummary = query.summary == "true"
    const exaApiKey = query.exaApiKey

    if (!exaApiKey) {
        return `No API Key provided`
    }

    const exa = new Exa(exaApiKey);
    let results;
    if (showSummary) {
        // results = await exa.searchAndContents(
        //     "In a marxist/anarchist point of view, give me some links of articles, books about:" + searchQuery,
        //     {
        //         type: "neural",
        //         useAutoprompt: true,
        //         numResults: 10,
        //         summary: {
        //             query: "What does this link cover?"
        //         },
        //     }
        // );

        results = { "requestId": "1bca9684038549068cbf7b29087df50e", "autopromptString": "Here is a link to articles and books from a Marxist/Anarchist perspective on the creation of the state:", "resolvedSearchType": "neural", "results": [{ "score": 0.2123832404613495, "title": "An Anarchist View of State Formation-- Review of Peter Gelderloos, Worshipping Power: An Anarchist View of Early State Formation", "id": "https://www.anarkismo.net/article/31226", "url": "https://www.anarkismo.net/article/31226", "publishedDate": "2022-07-28T00:00:00.000Z", "author": "KAF", "summary": "This article reviews Peter Gelderloos' book, \"Worshipping Power: An Anarchist View of Early State Formation.\" It delves into Gelderloos' analysis of the state, arguing against specific theories of its origins and rejecting the class theory of the state. The article examines Gelderloos' main hypotheses, his views on the relationship between state formation and class divisions, and his interpretation of Bakunin's ideas. \n" }, { "score": 0.21201977133750916, "title": "Worshiping Power", "id": "https://theanarchistlibrary.org/library/peter-gelderloos-worshipping-power", "url": "https://theanarchistlibrary.org/library/peter-gelderloos-worshipping-power", "publishedDate": "2017-01-10T00:00:00.000Z", "author": "Author: Peter Gelderloos", "summary": "This article delves into the origins and nature of the state, challenging the conventional narrative that states arose out of necessity for organization and progress. The author argues that state formation is a predatory and unnecessary act, citing historical evidence of resistance to states and the existence of successful stateless societies. The article also highlights the dangers of states, particularly in the context of contemporary issues like climate change and mass extinction. \n", "image": "https://theanarchistlibrary.org/sitefiles/en/opengraph.png" }, { "score": 0.2097248136997223, "title": "The Origin of the State", "id": "https://theanarchistlibrary.org/library/the-origin-of-the-state.html", "url": "https://theanarchistlibrary.org/library/the-origin-of-the-state.html", "publishedDate": "2006-01-01T00:00:00.000Z", "author": "Harold Barclay", "summary": "This link explores the origins and development of the state. It examines key factors that contribute to state formation, including population size, sedentary settlement, agriculture, redistribution of resources, military organization, and social hierarchies. The text highlights that the emergence of a state involves a complex interplay of these elements, rather than a single cause. It also discusses the role of pre-state systems and how they evolve towards statehood. \n" }, { "score": 0.20332816243171692, "title": "Supporter Updates", "id": "https://c4ss.org/content/tag/state-formation", "url": "https://c4ss.org/content/tag/state-formation", "publishedDate": "2018-08-27T00:00:00.000Z", "author": "Kevin Carson", "summary": "This page is a collection of articles by Kevin Carson on the topic of state formation. It covers a variety of subjects, including: \n\n* **The Palestinian-Israeli conflict**: Discussing the recent Hamas attacks and the role of the state in creating conflict. \n* **Anarchist critiques of state formation**: Analyzing the work of scholars like James C. Scott and Peter Gelderloos, and how their work contributes to anarchist theory. \n* **The importance of accessible anarchist theory**:  Recognizing the need for accessible anarchist theory in the face of limited discourse and barriers to access. \n", "image": "http://c4ss.org/wp-content/themes/center2015/images/og.jpg" }, { "score": 0.20242372155189514, "title": "[Video] The life and ideas of Lenin – Marxist Student Federation school 2022", "id": "https://www.marxist.com/the-state.htm", "url": "https://www.marxist.com/the-state.htm", "publishedDate": "2022-08-19T00:00:00.000Z", "author": "Ben Gliniecki", "summary": "This article explains the Marxist perspective on the state. It argues that the state is not a neutral or just institution, but rather an instrument of the ruling class to oppress the masses and protect property relations. The article emphasizes that the state is inseparable from class society and ultimately relies on the use of force to maintain the status quo. \n" }, { "score": 0.201547309756279, "title": "State: an introduction", "id": "https://libcom.org/article/state-introduction", "url": "https://libcom.org/article/state-introduction", "publishedDate": "2012-08-27T00:00:00.000Z", "author": null, "summary": "This article from libcom.org provides an introduction to the state. It explores the common features of states regardless of their political system or economic structure, highlighting that all states are ultimately organizations of lawmaking and law-enforcing institutions within a specific territory, controlled by a minority. The article also examines the relationship between the state and capitalism, explaining how the success of capitalism within a state's territory influences its own success and ultimately the lives of its citizens. \n" }, { "score": 0.2012915015220642, "title": "state formation Archives", "id": "https://www.historyworkshop.org.uk/tag/state-formation/", "url": "https://www.historyworkshop.org.uk/tag/state-formation/", "publishedDate": "2019-10-01T00:00:00.000Z", "author": null, "summary": "This link takes you to the website of History Workshop, a digital magazine focused on radical history. They aim to understand the past, illuminate the present, and advocate for change in the world. They are an extension of the History Workshop Journal and continue the spirit of the History Workshop movement. \n" }, { "score": 0.20107772946357727, "title": "Engels: Violence and Origins of State", "id": "https://www.sfr-21.org/violence-state.html", "url": "https://www.sfr-21.org/violence-state.html", "author": "", "summary": "This link discusses the origins of the state, arguing that it emerged as a result of violence and the development of private property. It draws upon Engels' work, \"The Origin of the Family, Private Property and the State,\" and suggests that class conflict led to the need for a state to maintain the interests of the dominant class. \n" }, { "score": 0.20003792643547058, "title": "Origins of the British State", "id": "https://www.marxists.org/history/erol/uk.firstwave/mccreery-brit-state.htm", "url": "https://www.marxists.org/history/erol/uk.firstwave/mccreery-brit-state.htm", "author": "EROL", "summary": "This article discusses the origins of the British state, focusing on the historical context and the role of capitalist development in its formation. It argues that the union of England and Wales in the 16th century was driven by the needs of the emerging capitalist class, which required a unified market for economic growth. The article also analyzes the role of the feudal system and its demise in the rise of capitalism, highlighting the displacement of peasants and the creation of a proletariat. \n" }, { "score": 0.19987481832504272, "title": "View of The Genesis of State and Revolution", "id": "https://socialistregister.com/index.php/srv/article/view/5415/2314", "url": "https://socialistregister.com/index.php/srv/article/view/5415/2314", "publishedDate": "2004-01-01T00:00:00.000Z", "author": "", "summary": "This link takes you to an article titled \"The Genesis of State and Revolution\" published in the Socialist Register. The article is available for download as a PDF. \n" }] }

    } else {
        // results = await exa.search(
        //     "In a marxist/anarchist point of view, give me some links of articles, books about:" + searchQuery,
        //     {
        //         type: "neural",
        //         useAutoprompt: true,
        //         numResults: 10,
        //     }
        // );

        results = { "requestId": "1bca9684038549068cbf7b29087df50e", "autopromptString": "Here is a link to articles and books from a Marxist/Anarchist perspective on the creation of the state:", "resolvedSearchType": "neural", "results": [{ "score": 0.2123832404613495, "title": "An Anarchist View of State Formation-- Review of Peter Gelderloos, Worshipping Power: An Anarchist View of Early State Formation", "id": "https://www.anarkismo.net/article/31226", "url": "https://www.anarkismo.net/article/31226", "publishedDate": "2022-07-28T00:00:00.000Z", "author": "KAF", "summary": "This article reviews Peter Gelderloos' book, \"Worshipping Power: An Anarchist View of Early State Formation.\" It delves into Gelderloos' analysis of the state, arguing against specific theories of its origins and rejecting the class theory of the state. The article examines Gelderloos' main hypotheses, his views on the relationship between state formation and class divisions, and his interpretation of Bakunin's ideas. \n" }, { "score": 0.21201977133750916, "title": "Worshiping Power", "id": "https://theanarchistlibrary.org/library/peter-gelderloos-worshipping-power", "url": "https://theanarchistlibrary.org/library/peter-gelderloos-worshipping-power", "publishedDate": "2017-01-10T00:00:00.000Z", "author": "Author: Peter Gelderloos", "summary": "This article delves into the origins and nature of the state, challenging the conventional narrative that states arose out of necessity for organization and progress. The author argues that state formation is a predatory and unnecessary act, citing historical evidence of resistance to states and the existence of successful stateless societies. The article also highlights the dangers of states, particularly in the context of contemporary issues like climate change and mass extinction. \n", "image": "https://theanarchistlibrary.org/sitefiles/en/opengraph.png" }, { "score": 0.2097248136997223, "title": "The Origin of the State", "id": "https://theanarchistlibrary.org/library/the-origin-of-the-state.html", "url": "https://theanarchistlibrary.org/library/the-origin-of-the-state.html", "publishedDate": "2006-01-01T00:00:00.000Z", "author": "Harold Barclay", "summary": "This link explores the origins and development of the state. It examines key factors that contribute to state formation, including population size, sedentary settlement, agriculture, redistribution of resources, military organization, and social hierarchies. The text highlights that the emergence of a state involves a complex interplay of these elements, rather than a single cause. It also discusses the role of pre-state systems and how they evolve towards statehood. \n" }, { "score": 0.20332816243171692, "title": "Supporter Updates", "id": "https://c4ss.org/content/tag/state-formation", "url": "https://c4ss.org/content/tag/state-formation", "publishedDate": "2018-08-27T00:00:00.000Z", "author": "Kevin Carson", "summary": "This page is a collection of articles by Kevin Carson on the topic of state formation. It covers a variety of subjects, including: \n\n* **The Palestinian-Israeli conflict**: Discussing the recent Hamas attacks and the role of the state in creating conflict. \n* **Anarchist critiques of state formation**: Analyzing the work of scholars like James C. Scott and Peter Gelderloos, and how their work contributes to anarchist theory. \n* **The importance of accessible anarchist theory**:  Recognizing the need for accessible anarchist theory in the face of limited discourse and barriers to access. \n", "image": "http://c4ss.org/wp-content/themes/center2015/images/og.jpg" }, { "score": 0.20242372155189514, "title": "[Video] The life and ideas of Lenin – Marxist Student Federation school 2022", "id": "https://www.marxist.com/the-state.htm", "url": "https://www.marxist.com/the-state.htm", "publishedDate": "2022-08-19T00:00:00.000Z", "author": "Ben Gliniecki", "summary": "This article explains the Marxist perspective on the state. It argues that the state is not a neutral or just institution, but rather an instrument of the ruling class to oppress the masses and protect property relations. The article emphasizes that the state is inseparable from class society and ultimately relies on the use of force to maintain the status quo. \n" }, { "score": 0.201547309756279, "title": "State: an introduction", "id": "https://libcom.org/article/state-introduction", "url": "https://libcom.org/article/state-introduction", "publishedDate": "2012-08-27T00:00:00.000Z", "author": null, "summary": "This article from libcom.org provides an introduction to the state. It explores the common features of states regardless of their political system or economic structure, highlighting that all states are ultimately organizations of lawmaking and law-enforcing institutions within a specific territory, controlled by a minority. The article also examines the relationship between the state and capitalism, explaining how the success of capitalism within a state's territory influences its own success and ultimately the lives of its citizens. \n" }, { "score": 0.2012915015220642, "title": "state formation Archives", "id": "https://www.historyworkshop.org.uk/tag/state-formation/", "url": "https://www.historyworkshop.org.uk/tag/state-formation/", "publishedDate": "2019-10-01T00:00:00.000Z", "author": null, "summary": "This link takes you to the website of History Workshop, a digital magazine focused on radical history. They aim to understand the past, illuminate the present, and advocate for change in the world. They are an extension of the History Workshop Journal and continue the spirit of the History Workshop movement. \n" }, { "score": 0.20107772946357727, "title": "Engels: Violence and Origins of State", "id": "https://www.sfr-21.org/violence-state.html", "url": "https://www.sfr-21.org/violence-state.html", "author": "", "summary": "This link discusses the origins of the state, arguing that it emerged as a result of violence and the development of private property. It draws upon Engels' work, \"The Origin of the Family, Private Property and the State,\" and suggests that class conflict led to the need for a state to maintain the interests of the dominant class. \n" }, { "score": 0.20003792643547058, "title": "Origins of the British State", "id": "https://www.marxists.org/history/erol/uk.firstwave/mccreery-brit-state.htm", "url": "https://www.marxists.org/history/erol/uk.firstwave/mccreery-brit-state.htm", "author": "EROL", "summary": "This article discusses the origins of the British state, focusing on the historical context and the role of capitalist development in its formation. It argues that the union of England and Wales in the 16th century was driven by the needs of the emerging capitalist class, which required a unified market for economic growth. The article also analyzes the role of the feudal system and its demise in the rise of capitalism, highlighting the displacement of peasants and the creation of a proletariat. \n" }, { "score": 0.19987481832504272, "title": "View of The Genesis of State and Revolution", "id": "https://socialistregister.com/index.php/srv/article/view/5415/2314", "url": "https://socialistregister.com/index.php/srv/article/view/5415/2314", "publishedDate": "2004-01-01T00:00:00.000Z", "author": "", "summary": "This link takes you to an article titled \"The Genesis of State and Revolution\" published in the Socialist Register. The article is available for download as a PDF. \n" }] }
    }

    return results.results
})